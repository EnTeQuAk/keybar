language: python
python:
  - '3.4'
  - '3.5'
sudo: false

addons:
  postgresql: '9.4'
  hosts:
    - keybar.local
  apt:
    sources:
      - ubuntu-toolchain-r-test
      - debian-sid
    packages:
      - gcc-4.7
      - g++-4.8
      - openssl
      - libssl-dev

services:
  - memcached
  - redis-server

compiler:
  - gcc

cache:
  apt: true
  directories:
    - $HOME/.cache/pip/

env:
  global:
    - DJANGO_SETTINGS_MODULE="keybar.conf.travis"
    - KEYBAR_TEST_DB_NAME=keybar_test
    - KEYBAR_TEST_DB_USER=travis

before_install:
  - g++ --version
  - npm config set python /usr/bin/python2.7

before_script:
  - psql -c 'create database keybar_test;' -U postgres

script:
  - openssl version
  - psql --version
  - make develop
  - make test
